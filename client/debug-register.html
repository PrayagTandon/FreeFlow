<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Registration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        input { padding: 8px; margin: 5px; width: 200px; }
        label { display: block; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>üîß Debug Registration</h1>
    
    <div class="test-section">
        <h3>Test Registration</h3>
        <form id="registerForm">
            <label>First Name: <input type="text" id="firstName" value="Test" /></label>
            <label>Last Name: <input type="text" id="lastName" value="User" /></label>
            <label>Email: <input type="email" id="email" value="test3@example.com" /></label>
            <label>Password: <input type="password" id="password" value="password123" /></label>
            <label>Role: 
                <select id="role">
                    <option value="Freelancer">Freelancer</option>
                    <option value="Client">Client</option>
                </select>
            </label>
            <label>Wallet: <input type="text" id="wallet" value="0x1234567890123456789012345678901234567890" /></label>
            <button type="submit">Test Registration</button>
        </form>
        <div id="register-result"></div>
    </div>

    <script>
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('register-result');
            resultDiv.innerHTML = 'Testing registration...';
            
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                role: document.getElementById('role').value,
                wallet: document.getElementById('wallet').value
            };
            
                         try {
                 console.log('=== CLIENT SIDE DEBUG ===');
                 console.log('Sending registration request:', formData);
                 console.log('Request URL:', '/api/register');
                 console.log('Request method:', 'POST');
                 console.log('Request headers:', { 
                     'Content-Type': 'application/json',
                     'Accept': 'application/json'
                 });
                 
                 const response = await fetch('/api/register', {
                     method: 'POST',
                     headers: { 
                         'Content-Type': 'application/json',
                         'Accept': 'application/json'
                     },
                     body: JSON.stringify(formData)
                 });
                 
                 console.log('Response received');
                 console.log('Response status:', response.status);
                 console.log('Response status text:', response.statusText);
                 console.log('Response ok:', response.ok);
                 console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                 
                 let responseText;
                 try {
                     responseText = await response.text();
                     console.log('Response text:', responseText);
                 } catch (textError) {
                     console.error('Failed to read response text:', textError);
                     responseText = 'Could not read response';
                 }
                 
                 if (!response.ok) {
                     let errorData;
                     try {
                         errorData = JSON.parse(responseText);
                     } catch (parseError) {
                         errorData = { error: 'Could not parse error response', raw: responseText };
                     }
                     
                     console.error('Response not ok:', errorData);
                     resultDiv.className = 'error';
                     resultDiv.innerHTML = `
                         <strong>‚ùå Registration Failed (${response.status}):</strong><br>
                         <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                         <strong>Error:</strong> ${errorData.error || 'Unknown error'}<br>
                         <strong>Details:</strong> ${errorData.details || 'No details'}<br>
                         <strong>Raw Response:</strong><pre>${responseText}</pre>
                     `;
                     return;
                 }
                 
                 let data;
                 try {
                     data = JSON.parse(responseText);
                     console.log('Parsed response data:', data);
                 } catch (parseError) {
                     console.error('Failed to parse response JSON:', parseError);
                     resultDiv.className = 'error';
                     resultDiv.innerHTML = `<strong>‚ùå JSON Parse Error:</strong> ${parseError.message}<br><strong>Raw Response:</strong><pre>${responseText}</pre>`;
                     return;
                 }
                 
                 resultDiv.className = 'success';
                 resultDiv.innerHTML = `<strong>‚úÖ Registration Successful:</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
                 
             } catch (error) {
                 console.error('=== CLIENT SIDE ERROR ===');
                 console.error('Error type:', error.constructor.name);
                 console.error('Error message:', error.message);
                 console.error('Error stack:', error.stack);
                 console.error('Full error object:', error);
                 
                 resultDiv.className = 'error';
                 resultDiv.innerHTML = `
                     <strong>‚ùå Network/Client Error:</strong><br>
                     <strong>Type:</strong> ${error.constructor.name}<br>
                     <strong>Message:</strong> ${error.message}<br>
                     <strong>Stack:</strong><pre>${error.stack || 'No stack trace available'}</pre>
                 `;
             }
        });
    </script>
</body>
</html> 